{% extends '@CustomDatabase/sidebar/sidebar.html.twig' %}

{% block head_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/customdatabase/static/database/style.css') }}" crossorigin="anonymous" />
{% endblock %}

{% block headscripts %}
    {{ parent() }}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ asset('bundles/customdatabase/static/job-automation/script.js') }}"></script>
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="job-automation-content">
        <div class="database-header">
            <div class="header-actions">
                <a href="{{ path('home') }}" class="btn-back">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <button class="btn-create-job" onclick="openCreateJobModal()">
                    <i class="fas fa-plus"></i> Create New Job
                </button>
            </div>
            <h1><i class="fas fa-tasks"></i> Advanced Job Automation System</h1>
            <p>Automate complex workflows, schedule tasks, monitor performance, and manage job execution with intelligent automation</p>
        </div>

        <!-- Job Overview Section -->
        <div class="job-overview-section">
            <h2><i class="fas fa-chart-network"></i> Job Automation Overview</h2>
            <div class="job-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Active Jobs</h4>
                        <div class="stat-value" id="active-jobs">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Scheduled Jobs</h4>
                        <div class="stat-value" id="scheduled-jobs">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Completed Today</h4>
                        <div class="stat-value" id="completed-jobs">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h4>Failed Jobs</h4>
                        <div class="stat-value" id="failed-jobs">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Management Section -->
        <div class="job-management-section">
            <div class="section-header">
                <h2><i class="fas fa-cogs"></i> Job Management</h2>
                <div class="section-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="job-search" placeholder="Search jobs...">
                    </div>
                    <select id="job-status-filter">
                        <option value="all">All Status</option>
                        <option value="active">Active</option>
                        <option value="scheduled">Scheduled</option>
                        <option value="running">Running</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                        <option value="paused">Paused</option>
                    </select>
                </div>
            </div>

            <div class="job-workflow-builder">
                <div class="workflow-canvas" id="workflow-canvas">
                    <!-- Workflow nodes will be dynamically added here -->
                    <div class="workflow-placeholder">
                        <i class="fas fa-project-diagram"></i>
                        <h3>Workflow Builder</h3>
                        <p>Drag and drop job components to build automated workflows</p>
                        <button class="btn-start-building" onclick="startWorkflowBuilder()">
                            <i class="fas fa-plus"></i> Start Building
                        </button>
                    </div>
                </div>
            </div>

            <div class="job-list-section">
                <h3>Job Queue & History</h3>
                <div class="job-list" id="job-list">
                    <!-- Job items will be loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Job Scheduling Section -->
        <div class="job-scheduling-section">
            <h2><i class="fas fa-calendar-alt"></i> Advanced Job Scheduling</h2>
            <div class="scheduling-interface">
                <div class="schedule-config-panel">
                    <h3>Schedule Configuration</h3>
                    <div class="schedule-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="schedule-frequency">Frequency</label>
                                <select id="schedule-frequency">
                                    <option value="once">Run Once</option>
                                    <option value="minute">Every Minute</option>
                                    <option value="hourly">Hourly</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="custom">Custom Cron</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="schedule-time">Time</label>
                                <input type="time" id="schedule-time">
                            </div>
                        </div>
                        <div class="form-row" id="custom-cron-row" style="display: none;">
                            <div class="form-group">
                                <label for="custom-cron">Cron Expression</label>
                                <input type="text" id="custom-cron" placeholder="0 0 * * *">
                                <small class="form-help">Minute Hour Day Month DayOfWeek</small>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn-create-schedule" onclick="createSchedule()">
                                <i class="fas fa-calendar-plus"></i> Create Schedule
                            </button>
                            <button class="btn-test-schedule" onclick="testSchedule()">
                                <i class="fas fa-play"></i> Test Schedule
                            </button>
                        </div>
                    </div>
                </div>

                <div class="schedule-calendar-panel">
                    <h3>Schedule Calendar</h3>
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <button class="btn-prev-month" onclick="prevMonth()"><</button>
                            <h4 id="calendar-month-year">December 2024</h4>
                            <button class="btn-next-month" onclick="nextMonth()">></button>
                        </div>
                        <div class="calendar-grid" id="calendar-grid">
                            <!-- Calendar days will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Monitoring Section -->
        <div class="job-monitoring-section">
            <h2><i class="fas fa-chart-line"></i> Job Performance Monitoring</h2>
            <div class="monitoring-dashboard">
                <div class="monitoring-cards">
                    <div class="monitor-card">
                        <h4>Average Execution Time</h4>
                        <div class="metric-value" id="avg-execution-time">0ms</div>
                        <div class="metric-trend">
                            <i class="fas fa-arrow-up"></i> +5.2%
                        </div>
                    </div>
                    <div class="monitor-card">
                        <h4>Success Rate</h4>
                        <div class="metric-value" id="success-rate">98.5%</div>
                        <div class="metric-trend positive">
                            <i class="fas fa-arrow-up"></i> +2.1%
                        </div>
                    </div>
                    <div class="monitor-card">
                        <h4>Jobs per Hour</h4>
                        <div class="metric-value" id="jobs-per-hour">24</div>
                        <div class="metric-trend">
                            <i class="fas fa-arrow-down"></i> -1.5%
                        </div>
                    </div>
                </div>

                <div class="performance-charts">
                    <div class="chart-container">
                        <h4>Job Execution Timeline</h4>
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-area"></i>
                            <p>Execution timeline chart</p>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h4>Resource Usage</h4>
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-pie"></i>
                            <p>Resource usage chart</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Job Modal -->
<div class="modal fade" id="createJobModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Create New Automated Job</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="create-job-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="job-name">Job Name</label>
                            <input type="text" id="job-name" required>
                        </div>
                        <div class="form-group">
                            <label for="job-type">Job Type</label>
                            <select id="job-type" required>
                                <option value="">Select Type</option>
                                <option value="data-import">Data Import</option>
                                <option value="data-export">Data Export</option>
                                <option value="data-sync">Data Synchronization</option>
                                <option value="backup">Database Backup</option>
                                <option value="cleanup">Data Cleanup</option>
                                <option value="report">Report Generation</option>
                                <option value="api-call">API Call</option>
                                <option value="custom">Custom Script</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="job-description">Description</label>
                            <textarea id="job-description" rows="3" placeholder="Describe what this job does..."></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="job-priority">Priority</label>
                            <select id="job-priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="job-timeout">Timeout (minutes)</label>
                            <input type="number" id="job-timeout" value="30" min="1" max="1440">
                        </div>
                    </div>
                    <div class="job-config-section" id="job-config-section">
                        <!-- Dynamic configuration options based on job type -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn-primary" onclick="createJob()">Create Job</button>
            </div>
        </div>
    </div>
</div>

<style>
/* Job Automation Styles */
.job-overview-section {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 20px;
}

.job-overview-section h2 {
    font-size: 24px;
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 25px;
    text-align: center;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.job-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.job-management-section {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 20px;
}

.job-workflow-builder {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 30px;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.workflow-canvas {
    min-height: 400px;
    border: 2px dashed #e2e8f0;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.workflow-placeholder {
    text-align: center;
    color: #666;
}

.workflow-placeholder i {
    font-size: 48px;
    color: var(--primary-color);
    margin-bottom: 15px;
}

.btn-start-building {
    background: var(--primary-gradient);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-start-building:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.job-scheduling-section {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 20px;
}

.scheduling-interface {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.schedule-config-panel, .schedule-calendar-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 25px;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.job-monitoring-section {
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 20px;
}

.monitoring-dashboard {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 25px;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.monitoring-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.monitor-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    border: 1px solid #e2e8f0;
}

.monitor-card h4 {
    font-size: 14px;
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 10px;
}

.metric-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 5px;
}

.metric-trend {
    font-size: 12px;
    color: #e74c3c;
}

.metric-trend.positive {
    color: #27ae60;
}

.performance-charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.chart-container {
    background: white;
    border-radius: 8px;
    padding: 20px;
    border: 1px solid #e2e8f0;
}

.chart-container h4 {
    font-size: 16px;
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 15px;
}

.chart-placeholder {
    height: 150px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #666;
    background: #f8f9fa;
    border-radius: 8px;
    border: 2px dashed #e2e8f0;
}

.chart-placeholder i {
    font-size: 32px;
    margin-bottom: 10px;
    color: var(--primary-color);
}

/* Modal Styles */
.modal-content {
    border-radius: 12px;
    border: none;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
}

.modal-header {
    background: var(--primary-gradient);
    color: white;
    border-radius: 12px 12px 0 0;
    border-bottom: none;
    padding: 20px 25px;
}

.modal-body {
    padding: 25px;
}

.job-config-section {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .job-stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .scheduling-interface {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .performance-charts {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .job-overview-section,
    .job-management-section,
    .job-scheduling-section,
    .job-monitoring-section {
        padding: 20px;
    }

    .job-stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }

    .monitoring-cards {
        grid-template-columns: 1fr;
        gap: 15px;
    }

    .workflow-canvas {
        min-height: 300px;
    }
}
</style>

{% endblock %}